name: CI NetSpy üïµÔ∏è‚Äç‚ôÇÔ∏è

on:
  push:
    branches: [ "main" ]
    # Esto hace que el pipeline solo corra si modificas archivos dentro de netspy
    # (Para no gastar recursos si tocas otras cosas del toolkit)
    paths:
      - 'c/netspy/**'
  pull_request:
    branches: [ "main" ]
    paths:
      - 'c/netspy/**'

jobs:
  # Tarea 1: Verificar que Go compila
  build-go:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./c/netspy  # <--- ¬°Aqu√≠ est√° el truco!

    steps:
    - name: üì• Descargar c√≥digo
      uses: actions/checkout@v4

    - name: üêπ Instalar Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.23'

    - name: ‚¨áÔ∏è Bajar dependencias
      run: go mod download

    - name: üî® Compilar
      run: go build -v .

  # Tarea 2: Verificar que Docker construye la imagen
  build-docker:
    needs: build-go
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./c/netspy # <--- ¬°Aqu√≠ tambi√©n!

    steps:
    - name: üì• Descargar c√≥digo
      uses: actions/checkout@v4

    - name: üê≥ Construir Imagen Docker
      # El punto final (.) se refiere al working-directory definido arriba
      run: docker build .
